{"version":3,"file":"index.js","sources":["../../../node_modules/@babel/runtime/helpers/esm/extends.js","../../../node_modules/@babel/runtime/helpers/esm/createClass.js","../src/config.ts","../src/interceptor.ts","../src/index.ts"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import { AxiosRequestConfig, AxiosResponse, AxiosError } from 'axios';\n\nexport { AxiosRequestConfig }\n\nexport type PerfectRequestConfig = {\n    http?: AxiosRequestConfig;\n    /** 异常处理 */\n    exception: {\n        /** 常规 callback */\n        callback?(res?: AxiosError | Record<string, unknown> | AxiosResponse): any;\n        /** 请求最终处理结果 */\n        finally?(res?:AxiosResponse | Record<string, unknown> | AxiosError): any;\n    };\n    /** 请求拦截 */\n    interceptor: {\n        request?(res?: AxiosResponse | Record<string, unknown> | AxiosError, config?: Config): (AxiosResponse | Promise<any>);\n    };\n}\n\nexport type Config = PerfectRequestConfig & AxiosRequestConfig;\n\nexport type ConfigHookShape = {\n    (config?: Config): Config;\n}\n\nconst getDefaultConfig: ConfigHookShape  = () => {\n    return {\n        http: {\n            /** 默认 25 秒超时 */\n            timeout: 25000,\n            /** 需要服务端同步开启，这里默认开启 */\n            withCredentials: true,\n            // headers: {\n            //     'Content-Type': 'application/json',\n            //     // 'Accept': 'application/json',\n            // },\n        },\n        exception: {\n            callback: undefined,\n            finally: undefined,\n        },\n        interceptor: {\n            request: undefined,\n        }\n    }\n};\n\nexport default getDefaultConfig;","import { BaseInterceptor } from './interface/interceptor';\nimport { AxiosError, AxiosRequestConfig, AxiosResponse } from 'axios';\nimport { Config } from './config';\n\nexport class Interceptor implements BaseInterceptor {\n    constructor() {\n    }\n\n    normalRequest(res: AxiosRequestConfig, config: Config): AxiosRequestConfig {\n        return {\n            ...res,\n        };\n    }\n\n    responseSuccess(res: AxiosResponse | Record<string, unknown>, config: Config): AxiosResponse | Promise<any> | undefined {\n        typeof config.exception.finally === 'function' && config.exception.finally(res);\n        return config.interceptor?.request?.(res) || this.responseFail(res, config);\n    }\n\n    responseFail(err: AxiosError | AxiosResponse | Record<string, unknown>, config: Config): Promise<any> {\n        typeof config?.exception?.finally === 'function' && config.exception.finally(err);\n\n        if (config.exception.callback && typeof config.exception.callback === 'function') {\n            return Promise.reject(config.exception.callback(err));\n        }\n        return Promise.reject(err);\n    }\n\n}","import axios, { AxiosInstance, AxiosRequestConfig, AxiosError, AxiosResponse } from 'axios';\n\nimport getDefaultConfig, { Config } from './config';\nimport { Interceptor } from './interceptor';\n\nconst interceptor = new Interceptor();\n\ntype PerfectRequestConstructor = {\n    http?: AxiosRequestConfig;\n    onRequest?(res?: AxiosResponse | Record<string, unknown> | AxiosError, config?: Config): AxiosResponse;\n    onFailure?(err?: AxiosError | Record<string, unknown>): any;\n    onFinally?(res?: AxiosResponse | Record<string, unknown> | AxiosError): any;\n};\n\nclass PerfectRequest {\n    private httpConfig: Config = { exception: {}, interceptor: {} };\n    private instance: AxiosInstance | undefined;\n\n    /** 获取 axios instance */\n    static getInstance(config: Config['http']) {\n        return axios.create(config);\n    }\n\n    constructor(props: PerfectRequestConstructor) {\n        this.initInstance(props);\n    }\n\n    protected get httpInstance(): AxiosInstance | undefined {\n        return this.instance;\n    }\n\n    protected initInstance(props: PerfectRequestConstructor) {\n        this.httpConfig = getDefaultConfig() || {};\n        this.instance = PerfectRequest.getInstance({\n            ...this.httpConfig.http,\n            ...(props?.http || {}),\n        });\n        // 初始化异常\n        this.initException(props);\n        // 注册请求前拦截器，主要注入一些默认的请求配置\n        this.instance.interceptors.request.use(opts => interceptor?.normalRequest?.(opts, this.httpConfig));\n        // 注册请求后拦截器\n        this.instance.interceptors.response.use(\n            res => interceptor.responseSuccess(res, this.httpConfig),\n            err => interceptor.responseFail(err, this.httpConfig),\n        );\n    }\n\n    protected initException(props: PerfectRequestConstructor) {\n        this.httpConfig.exception.callback = props?.onFailure;\n        this.httpConfig.exception.finally = props?.onFinally;\n        this.httpConfig.interceptor.request = props?.onRequest;\n    }\n}\n\nexport default PerfectRequest;\n"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","_createClass","Constructor","protoProps","staticProps","getDefaultConfig","http","timeout","withCredentials","exception","callback","undefined","interceptor","request","Interceptor","normalRequest","res","config","responseSuccess","responseFail","err","Promise","reject","PerfectRequest","getInstance","axios","create","httpConfig","instance","initInstance","initException","interceptors","use","opts","response","onFailure","onFinally","onRequest"],"mappings":"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"}